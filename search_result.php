<?php 

    include ('constants.php'); 
    include ('login-check.php'); 


?>
<!DOCTYPE html>
<html>
<head>
    <title>Hubble WebCrawler</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="css/index.css" />
    <link rel="stylesheet" href="css/search-result.css" />
    <link rel="stylesheet" href="css/web-crawler.css" />
    <link rel="icon" href="image/favicon.png" type="image/png" />
</head>
<body>
    <header>
        <h1>Hubble WebCrawler</h1>
        <!-- Navigation bar Starts Here -->
        <div class="menu text-center">
            <a href="index.php">Home</a>
            <a href="web-crawler.php">WebCrawler</a>
            <a href="logo.html">Logo</a>
            <a href="about-us.php">About Us</a>
            <div class="wrapper" style="display: inline-block; vertical-align: middle;">
        <ul>
          <li><a href="logout.php" class="btn1">Logout</a></li>
        </ul>
        </div>
        </div>
    </header>
    <!-- <hr /> -->
    <div class="boldline"></div>
    <!-- Welcome Banner Starts Here -->
    <div class="banner-txt banner">
        <h2>"Presenting the Search Results"</h2>
    </div>

    <div id="search-results">
        <h3>Search Results</h3>
        <br />
        <?php
        // Load the search results from the 'search_results.csv' file generated by process_input.php
        $search_results_file = 'datas/search_results.csv';

        if (file_exists($search_results_file)) {
            $found_results = [];
            $rows = array_map('str_getcsv', file($search_results_file));

            foreach ($rows as $row) {
                // Check if the elements exist before accessing them
                if (isset($row[0]) && isset($row[1])) {
                    $found_results[] = array("url" => $row[0], "title" => $row[1]);
                }
            }
        } else {
            $found_results = false;
        }

        if ($found_results) {
            // Start the loop from index 1 to skip the header row (URL, Title)
            for ($i = 1; $i < count($found_results); $i++) {
                $result = $found_results[$i];
                $url = $result["url"];
                $title = $result["title"];
        
                echo '<div>';
                echo '<h4>' . $url . '</h4>'; // Display the actual title from the CSV file
                echo '<a href="' . $title . '">' . $title . '</a>';
                echo '</div>';
            }
        } else {
            echo "No matching results found.";
        }
        
        ?>
        </br>
        <h3>Click the button to download all the crawled pages in csv file</h>
    <div class="web-search">
    
        <a href="datas/crawled_data.csv" download="crawled_data.csv" style="text-decoration: none; color: black;">
        <input
          type="submit"
          name="submit"
          value="Download"
          class="btn btn-primary"
            />
        </a>
        
    </div>
    </div>
    
    <!-- <hr /> -->
    <div class="bold-line"></div>

    <!-- social Section Starts Here -->
    <section class="social">
        <div class="container text-center">
            <div class="social-links">
                <a href="https://www.facebook.com/" target="_blank">
                    <i class="fa fa-facebook"></i>
                </a>
                <a href="https://www.instagram.com/" target="_blank">
                    <i class="fa fa-instagram"></i>
                </a>
                <a href="https://www.twitter.com/" target="_blank">
                    <i class="fa fa-twitter"></i>
                </a>
                <a href="https://www.youtube.com/" target="_blank">
                    <i class="fa fa-youtube"></i>
                </a>
            </div>
        </div>
    </section>
    <!-- social Section Ends Here -->

    <!-- footer Section Starts Here -->
    <section class="footer">
        <div class="container text-center">
            <p>
                Copyright Â© 2079-2080
                <a href="index.php" target="_blank">HWC.LTD</a> All Rights Reserved.
            </p>
        </div>
    </section>
    <!-- footer Section Ends Here -->
</body>
</html>
